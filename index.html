<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css">
    <style>
      .fileUpload {
          position: relative;
          overflow: hidden;
          margin: 10px;
      }
      .fileUpload input.upload {
          position: absolute;
          top: 0;
          right: 0;
          margin: 0;
          padding: 0;
          font-size: 20px;
          cursor: pointer;
          opacity: 0;
          filter: alpha(opacity=0);
      }
    </style>
  </head>
  <body class="mixpanel-platform-body">
    
    <input id="uploadFile" placeholder="Choose File" disabled="disabled" />
    <div class="fileUpload btn btn-primary">
        <span>Upload</span>
        <input id="uploadBtn" type="file" class="upload" />
    </div>
    <!-- 
      1. Upload CSV's with revenue data.  Parse out transaction date (trans_date) and transaction amount
      (sale_amount) 
    
      2. Visualize a Segmentation Chart that AVG's daily revenue values over event counts
    
    -->
    <script type="text/javascript">
      /* Upload and Store data client-side */
      
      document.getElementById("uploadBtn").onchange = function () {
        document.getElementById("uploadFile").value = this.value;
        console.log(this.value);
      };
      
    
      // The event listener for the file upload
      document.getElementById('uploadBtn').addEventListener('change', upload, false);

      // Method that checks that the browser supports the HTML5 File API
      function browserSupportFileUpload() {
          var isCompatible = false;
          if (window.File && window.FileReader && window.FileList && window.Blob) {
          isCompatible = true;
          }
          return isCompatible;
      }
  
      // Method that reads and processes the selected file
      function upload(evt) {
      if (!browserSupportFileUpload()) {
          alert('The File APIs are not fully supported in this browser!');
          } else {
              var data = null;
              var file = evt.target.files[0];
              var reader = new FileReader();
              reader.readAsText(file);
              
              reader.onload = function(event) {
                  var csvData = event.target.result;
                  console.log(csvData);
                  data = $.csv.toArrays(csvData);
                  if (data && data.length > 0) {
                    alert('Imported -' + data.length + '- rows successfully!');
                  } else {
                      alert('No data to import!');
                  }
              };
              reader.onerror = function() {
                  alert('Unable to read ' + file.fileName);
              };
          }
      }
    </script>
    
  </body>
</html>
